<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="760" viewBox="0 0 1200 760">
  <defs>
    <style>
      .title { font: 700 26px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .sub { font: 500 16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #334155; }
      .h { font: 700 16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .t { font: 500 13px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #334155; }
      .mono { font: 500 12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; fill: #334155; }
      .stroke { stroke: #1f2937; stroke-width: 2; }
      .soft { stroke: #94a3b8; stroke-width: 2; }
      .fillA { fill: #ecfeff; }
      .fillB { fill: #eef2ff; }
      .fillC { fill: #f0fdf4; }
      .fillE { fill: #f8fafc; }
      .arrow { stroke: #0f172a; stroke-width: 2.5; fill: none; marker-end: url(#arrowHead); }
      .arrowSoft { stroke: #64748b; stroke-width: 2.5; fill: none; marker-end: url(#arrowHeadSoft); }
      .dashed { stroke-dasharray: 8 6; }
    </style>
    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#0f172a" />
    </marker>
    <marker id="arrowHeadSoft" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#64748b" />
    </marker>
  </defs>

  <rect x="0" y="0" width="1200" height="760" fill="#ffffff" />

  <text x="40" y="55" class="title">Fig. 2 — Example data model for failure entities and pattern entities</text>
  <text x="40" y="85" class="sub">Illustrative schema: failures are first-class records; patterns aggregate recurrent failures and link back to evidence runs/traces.</text>

  <!-- Failure entity -->
  <g transform="translate(70,140)">
    <rect x="0" y="0" width="520" height="470" rx="16" class="stroke fillA" />
    <text x="20" y="40" class="h">FailureEntity</text>
    <text x="20" y="70" class="mono">failure_id (PK)</text>

    <text x="20" y="110" class="t">• fingerprint: stable signature (normalized)</text>
    <text x="20" y="135" class="t">• category: e.g., prompt_injection, tool_error, parsing</text>
    <text x="20" y="160" class="t">• severity: low/medium/high/critical</text>
    <text x="20" y="185" class="t">• title + description</text>
    <text x="20" y="210" class="t">• evidence: span_ids, error messages, metadata</text>
    <text x="20" y="235" class="t">• first_seen_at, last_seen_at</text>
    <text x="20" y="260" class="t">• occurrence_count</text>
    <text x="20" y="285" class="t">• version: helps evolve definitions over time</text>

    <rect x="20" y="320" width="480" height="130" rx="12" class="soft fillE" />
    <text x="35" y="350" class="h" font-size="14">Relationships (examples)</text>
    <text x="35" y="378" class="t">• belongs_to PatternEntity via link table</text>
    <text x="35" y="402" class="t">• references RunEntity / TraceEntity (evidence)</text>
    <text x="35" y="426" class="t">• can be matched at pre-flight for warnings</text>
  </g>

  <!-- Pattern entity -->
  <g transform="translate(650,170)">
    <rect x="0" y="0" width="480" height="410" rx="16" class="stroke fillB" />
    <text x="20" y="40" class="h">PatternEntity</text>
    <text x="20" y="70" class="mono">pattern_id (PK)</text>

    <text x="20" y="110" class="t">• pattern_key: cluster signature (rule/heuristic)</text>
    <text x="20" y="135" class="t">• pattern_type: recurring, rising, seasonal, etc.</text>
    <text x="20" y="160" class="t">• summary: human-readable diagnosis</text>
    <text x="20" y="185" class="t">• affected_components: tool/model/prompt version</text>
    <text x="20" y="210" class="t">• window: time window used for detection</text>
    <text x="20" y="235" class="t">• confidence_score</text>
    <text x="20" y="260" class="t">• first_detected_at, last_detected_at</text>

    <rect x="20" y="295" width="440" height="90" rx="12" class="soft fillE" />
    <text x="35" y="325" class="h" font-size="14">Derived outputs (examples)</text>
    <text x="35" y="353" class="t">• recommended_action (warn / block / route)</text>
    <text x="35" y="377" class="t">• health_impact_delta</text>
  </g>

  <!-- Link table -->
  <g transform="translate(520,560)">
    <rect x="0" y="0" width="360" height="110" rx="16" class="stroke fillC" />
    <text x="20" y="38" class="h">FailurePatternLink</text>
    <text x="20" y="66" class="mono">failure_id (FK) + pattern_id (FK)</text>
    <text x="20" y="92" class="t">• strength / weight • rationale • created_at</text>
  </g>

  <!-- Arrows -->
  <path class="arrow" d="M590,430 C660,430 620,560 520,605" />
  <path class="arrow" d="M890,580 C860,520 850,520 820,500" opacity="0"/>

  <path class="arrow" d="M650,520 C650,560 650,560 650,560" opacity="0"/>

  <path class="arrow" d="M650,510 C650,555 650,555 650,560" opacity="0"/>

  <path class="arrow" d="M650,510 C620,545 600,560 600,560" opacity="0"/>

  <path class="arrowSoft dashed" d="M590,365 C650,365 650,325 650,325" />
  <text x="605" y="350" class="t" fill="#64748b">aggregates into</text>

  <path class="arrow" d="M700,580 C660,580 640,590 640,590" opacity="0"/>

  <path class="arrow" d="M700,590 C650,590 650,590 650,590" opacity="0"/>

  <path class="arrow" d="M590,604 C650,604 650,604 650,604" opacity="0"/>

  <path class="arrow" d="M590,604 C650,604 650,604 650,604" opacity="0"/>

  <path class="arrow" d="M650,432 C650,520 610,520 520,605" opacity="0"/>

  <path class="arrow" d="M650,450 C650,520 610,520 520,615" opacity="0"/>

  <path class="arrow" d="M650,470 C650,520 610,520 520,625" opacity="0"/>

  <!-- Correct explicit relationships -->
  <path class="arrow" d="M650,410 C610,430 600,520 590,560" />
  <path class="arrow" d="M880,580 C850,560 845,565 820,560" opacity="0"/>

  <path class="arrow" d="M890,580 C840,605 830,615 820,615" opacity="0"/>

  <path class="arrow" d="M650,430 C640,500 600,530 600,560" />

  <path class="arrow" d="M880,520 C850,540 850,560 880,580" opacity="0"/>

  <!-- From Pattern to Link -->
  <path class="arrow" d="M830,580 C780,610 760,615 740,615" />

  <!-- From Failure to Link -->
  <path class="arrow" d="M330,610 C420,645 465,650 520,635" />

  <!-- Notes -->
  <g transform="translate(70,650)">
    <rect x="0" y="0" width="1060" height="70" rx="14" class="soft fillE" />
    <text x="20" y="30" class="h">Notes</text>
    <text x="20" y="54" class="t">This figure is an example entity model for specification purposes; implementations may add indexes, partitions, and more evidence tables.</text>
  </g>
</svg>
